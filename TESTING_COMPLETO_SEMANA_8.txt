================================================================================
                    TESTING COMPLETO - SEMANA 8
              MÓDULO DE REPORTES Y DASHBOARD DE EMPLEADO
================================================================================

Fecha: 16 de Diciembre de 2025
Proyecto: Sistema de Gestión de Citas - Barbería y Spa
Desarrollado por: Ilich Esteban Reyes Botia

================================================================================
                         ÍNDICE DE PRUEBAS
================================================================================

1. TESTING DEL DASHBOARD DE EMPLEADO
   1.1. Visualización de citas del día
   1.2. Cambio de estado de citas (AJAX)
   1.3. Transiciones de estado permitidas

2. TESTING DEL MÓDULO DE REPORTES
   2.1. Dashboard principal de reportes
   2.2. Reporte por fecha
   2.3. Reporte por empleado
   2.4. Reporte por servicio
   2.5. Citas realizadas
   2.6. Citas pendientes

3. TESTING DE EXPORTACIONES
   3.1. Exportación a PDF
   3.2. Exportación a Excel

4. VERIFICACIÓN DE LIBRERÍAS
   4.1. TCPDF
   4.2. PhpSpreadsheet
   4.3. Extensión GD

================================================================================
       1. TESTING DEL DASHBOARD DE EMPLEADO
================================================================================

1.1. VISUALIZACIÓN DE CITAS DEL DÍA
------------------------------------
URL: http://localhost/gestion_citas/empleado/dashboard

Pasos a seguir:
1. Iniciar sesión con usuario empleado
2. Verificar que la página muestra las citas del día actual
3. Verificar que muestra:
   - Hora de la cita
   - Nombre del cliente
   - Servicio solicitado
   - Estado actual (con badge de color)
   - Botones de acción según el estado

Resultados esperados:
✓ La tabla muestra solo citas del día actual
✓ Los estados tienen colores correctos:
  - Pendiente: amarillo (warning)
  - Confirmada: azul (info)
  - En proceso: azul oscuro (primary)
  - Completada: verde (success)
  - Cancelada: rojo (danger)
✓ Los botones de acción son apropiados para cada estado

Verificación en base de datos:
SELECT c.*, e.nombre, e.apellido
FROM citas c
JOIN empleados e ON c.id_empleado = e.id_empleado
WHERE DATE(c.fecha_cita) = CURDATE()
  AND c.id_empleado = [ID_EMPLEADO]
ORDER BY c.hora_inicio;


1.2. CAMBIO DE ESTADO DE CITAS (AJAX)
--------------------------------------
Cita en estado PENDIENTE:

Pasos:
1. Localizar una cita en estado "Pendiente"
2. Hacer clic en el botón "Confirmar"
3. Confirmar la acción en el diálogo
4. Esperar la respuesta AJAX

Resultados esperados:
✓ Aparece diálogo de confirmación
✓ Al confirmar, muestra mensaje "Estado actualizado exitosamente"
✓ La página se recarga automáticamente
✓ El estado cambia a "Confirmada"
✓ Los botones disponibles cambian

Cita en estado CONFIRMADA:

Pasos:
1. Localizar una cita en estado "Confirmada"
2. Hacer clic en el botón "Iniciar Servicio"
3. Confirmar la acción

Resultados esperados:
✓ El estado cambia a "En Proceso"
✓ El badge cambia a color azul oscuro
✓ Solo aparece el botón "Completar"

Cita en estado EN_PROCESO:

Pasos:
1. Localizar una cita en estado "En Proceso"
2. Hacer clic en el botón "Completar"
3. Confirmar la acción

Resultados esperados:
✓ El estado cambia a "Completada"
✓ El badge cambia a color verde
✓ No aparecen botones de acción (solo "Ver Detalles")


1.3. TRANSICIONES DE ESTADO PERMITIDAS
---------------------------------------
Validar las siguientes transiciones en el código:

PENDIENTE puede cambiar a:
  ✓ Confirmada
  ✓ Cancelada

CONFIRMADA puede cambiar a:
  ✓ En Proceso
  ✓ Cancelada

EN_PROCESO puede cambiar a:
  ✓ Completada

COMPLETADA:
  ✓ Estado final, no permite cambios

CANCELADA:
  ✓ Estado final, no permite cambios

Prueba de seguridad:
- Intentar cambiar una cita que NO pertenece al empleado logueado
  (usar herramientas de desarrollador para modificar el id_cita)

Resultado esperado:
✓ Debe mostrar error: "Cita no encontrada"
✓ No debe permitir el cambio

Verificación del método actualizarEstado():
Archivo: app/Controllers/Empleado/Citas.php (líneas 83-131)


================================================================================
       2. TESTING DEL MÓDULO DE REPORTES
================================================================================

2.1. DASHBOARD PRINCIPAL DE REPORTES
-------------------------------------
URL: http://localhost/gestion_citas/admin/reportes

Pasos:
1. Iniciar sesión como administrador
2. Acceder al módulo de reportes
3. Verificar KPIs en la parte superior
4. Verificar que NO aparece la gráfica "Evolución de Citas" (fue eliminada)
5. Verificar las tablas de Top Empleados y Top Servicios

Resultados esperados:
✓ Muestra 4 KPIs:
  - Total de Citas
  - Citas Completadas (con porcentaje)
  - Citas Canceladas (con porcentaje)
  - Ingresos Totales (con promedio)

✓ NO debe aparecer la sección "Evolución de Citas"

✓ Top Empleados muestra máximo 5 empleados con:
  - Nombre completo
  - Total de citas completadas
  - Ingresos generados

✓ Servicios Más Solicitados muestra máximo 5 servicios con:
  - Nombre del servicio
  - Total de citas completadas
  - Ingresos generados


2.2. REPORTE POR FECHA
-----------------------
URL: http://localhost/gestion_citas/admin/reportes/por-fecha

Pasos:
1. Seleccionar rango de fechas
2. Hacer clic en "Filtrar"
3. Verificar la tabla de citas

Resultados esperados:
✓ Muestra todas las citas en el rango seleccionado
✓ La tabla incluye:
  - Fecha
  - Hora
  - Cliente
  - Empleado
  - Servicio
  - Estado
  - Precio
✓ Los estados tienen colores distintivos
✓ Se muestran estadísticas del período


2.3. REPORTE POR EMPLEADO
--------------------------
URL: http://localhost/gestion_citas/admin/reportes/por-empleado

Pasos:
1. Seleccionar rango de fechas
2. Hacer clic en "Filtrar"
3. Verificar la tabla de empleados

Resultados esperados:
✓ Muestra todos los empleados con actividad
✓ Para cada empleado muestra:
  - Nombre completo
  - Total de citas
  - Citas completadas
  - Citas canceladas
  - Citas pendientes
  - Ingresos generados
✓ Los datos coinciden con la base de datos


2.4. REPORTE POR SERVICIO
--------------------------
URL: http://localhost/gestion_citas/admin/reportes/por-servicio

Pasos:
1. Seleccionar rango de fechas
2. Hacer clic en "Filtrar"
3. Verificar la tabla de servicios

Resultados esperados:
✓ Muestra todos los servicios solicitados
✓ Para cada servicio muestra:
  - Nombre del servicio
  - Total de citas
  - Citas completadas
  - Citas canceladas
  - Precio unitario
  - Ingresos totales generados
✓ Ordenados por popularidad o ingresos


2.5. CITAS REALIZADAS
----------------------
URL: http://localhost/gestion_citas/admin/reportes/citas-realizadas

Pasos:
1. Seleccionar rango de fechas
2. Hacer clic en "Filtrar"
3. Verificar el listado

Resultados esperados:
✓ Muestra SOLO citas con estado "Completada"
✓ Muestra información detallada de cada cita
✓ Calcula correctamente los ingresos totales
✓ El total de ingresos coincide con la suma de precios


2.6. CITAS PENDIENTES
---------------------
URL: http://localhost/gestion_citas/admin/reportes/citas-pendientes

Pasos:
1. Opcionalmente seleccionar rango de fechas
2. Verificar el listado

Resultados esperados:
✓ Muestra citas en estados: Pendiente, Confirmada, En Proceso
✓ NO muestra citas Completadas ni Canceladas
✓ Útil para ver citas futuras o en curso


================================================================================
       3. TESTING DE EXPORTACIONES
================================================================================

3.1. EXPORTACIÓN A PDF
-----------------------
Prerequisitos:
✓ Composer instalado
✓ Librería TCPDF instalada (composer require tecnickcom/tcpdf)

Prueba 1: PDF General
URL: http://localhost/gestion_citas/admin/reportes/exportarPDF?tipo=general&fecha_inicio=2025-01-01&fecha_fin=2025-12-31

Resultados esperados:
✓ Descarga automática del archivo PDF
✓ Nombre del archivo: reporte_general_YYYY-MM-DD.pdf
✓ El PDF contiene:
  - Título: "REPORTE DE CITAS"
  - Período seleccionado
  - Tabla con estadísticas generales
  - Todos los datos formateados correctamente

Prueba 2: PDF por Empleado
URL: http://localhost/gestion_citas/admin/reportes/exportarPDF?tipo=empleado&fecha_inicio=2025-01-01&fecha_fin=2025-12-31

Resultados esperados:
✓ Descarga archivo: reporte_empleado_YYYY-MM-DD.pdf
✓ Contiene tabla con todos los empleados
✓ Datos coinciden con la vista web

Prueba 3: PDF por Servicio
URL: http://localhost/gestion_citas/admin/reportes/exportarPDF?tipo=servicio&fecha_inicio=2025-01-01&fecha_fin=2025-12-31

Resultados esperados:
✓ Descarga archivo: reporte_servicio_YYYY-MM-DD.pdf
✓ Contiene tabla con todos los servicios
✓ Datos coinciden con la vista web

Prueba 4: PDF de Citas Realizadas
URL: http://localhost/gestion_citas/admin/reportes/exportarPDF?tipo=realizadas&fecha_inicio=2025-01-01&fecha_fin=2025-12-31

Resultados esperados:
✓ Descarga archivo: reporte_realizadas_YYYY-MM-DD.pdf
✓ Contiene listado detallado de citas completadas
✓ Datos coinciden con la vista web

Verificación de código:
- Método: exportarPDF() en app/Controllers/Admin/Reportes.php (líneas 189-246)
- Métodos auxiliares:
  * generarPDFGeneral() (líneas 311-330)
  * generarPDFEmpleado() (líneas 332-361)
  * generarPDFServicio() (líneas 363-392)
  * generarPDFRealizadas() (líneas 394-423)


3.2. EXPORTACIÓN A EXCEL
-------------------------
Prerequisitos:
✓ Composer instalado
✓ PhpSpreadsheet instalado (composer require phpoffice/phpspreadsheet)
✓ Extensión GD habilitada en php.ini

Prueba 1: Excel General
URL: http://localhost/gestion_citas/admin/reportes/exportarExcel?tipo=general&fecha_inicio=2025-01-01&fecha_fin=2025-12-31

Resultados esperados:
✓ Descarga automática del archivo Excel (.xlsx)
✓ Nombre del archivo: reporte_general_YYYY-MM-DD.xlsx
✓ El archivo Excel contiene:
  - Fila 1: Título "REPORTE DE CITAS" (merged A1:F1)
  - Fila 2: Período seleccionado (merged A2:F2)
  - Estadísticas desde fila 4
  - Formato correcto (negrita en encabezados, alineación)
  - Columnas auto-ajustadas

Prueba 2: Excel por Empleado
URL: http://localhost/gestion_citas/admin/reportes/exportarExcel?tipo=empleado&fecha_inicio=2025-01-01&fecha_fin=2025-12-31

Resultados esperados:
✓ Descarga archivo: reporte_empleado_YYYY-MM-DD.xlsx
✓ Contiene tabla con encabezados:
  - Empleado
  - Total Citas
  - Completadas
  - Canceladas
  - Pendientes
  - Ingresos
✓ Datos coinciden con la base de datos

Prueba 3: Excel por Servicio
URL: http://localhost/gestion_citas/admin/reportes/exportarExcel?tipo=servicio&fecha_inicio=2025-01-01&fecha_fin=2025-12-31

Resultados esperados:
✓ Descarga archivo: reporte_servicio_YYYY-MM-DD.xlsx
✓ Contiene tabla con todos los servicios
✓ Formato de moneda correcto

Prueba 4: Excel de Citas Realizadas
URL: http://localhost/gestion_citas/admin/reportes/exportarExcel?tipo=realizadas&fecha_inicio=2025-01-01&fecha_fin=2025-12-31

Resultados esperados:
✓ Descarga archivo: reporte_realizadas_YYYY-MM-DD.xlsx
✓ Contiene listado completo de citas
✓ Columnas: Fecha, Hora, Cliente, Empleado, Servicio, Precio

Verificación de código:
- Método: exportarExcel() en app/Controllers/Admin/Reportes.php (líneas 251-305)
- Métodos auxiliares:
  * generarExcelGeneral() (líneas 429-453)
  * generarExcelEmpleado() (líneas 455-478)
  * generarExcelServicio() (líneas 480-503)
  * generarExcelRealizadas() (líneas 505-528)


================================================================================
       4. VERIFICACIÓN DE LIBRERÍAS
================================================================================

4.1. VERIFICAR TCPDF
---------------------
Método 1: Usando diagnostico.php
URL: http://localhost/gestion_citas/public/diagnostico.php

Buscar en la página:
✓ Sección "7. VERIFICACIÓN DE LIBRERÍAS PARA REPORTES"
✓ TCPDF: Instalada (versión 6.10.1)
✓ Ruta: vendor/tecnickcom/tcpdf/tcpdf.php

Método 2: Verificación manual
Ruta: C:\xampp\htdocs\gestion_citas\vendor\tecnickcom\tcpdf\tcpdf.php

Comando terminal:
cd C:\xampp\htdocs\gestion_citas
composer show tecnickcom/tcpdf

Resultado esperado:
name     : tecnickcom/tcpdf
versions : * 6.10.1


4.2. VERIFICAR PHPSPREADSHEET
------------------------------
Método 1: Usando diagnostico.php
URL: http://localhost/gestion_citas/public/diagnostico.php

Buscar:
✓ PhpSpreadsheet: Instalada (versión 5.3.0)
✓ Ruta: vendor/phpoffice/phpspreadsheet/

Método 2: Verificación manual
Comando terminal:
composer show phpoffice/phpspreadsheet

Resultado esperado:
name     : phpoffice/phpspreadsheet
versions : * 5.3.0


4.3. VERIFICAR EXTENSIÓN GD
----------------------------
Método 1: Usando diagnostico.php
URL: http://localhost/gestion_citas/public/diagnostico.php

Buscar:
✓ Extensión GD: Habilitada
✓ Si aparece "NO instalada", seguir pasos de corrección

Método 2: phpinfo()
Crear archivo: C:\xampp\htdocs\gestion_citas\public\info.php
Contenido:
<?php
phpinfo();
?>

URL: http://localhost/gestion_citas/public/info.php
Buscar: "gd"
Resultado esperado: Debe aparecer sección "gd" con versión

Método 3: Verificación en php.ini
Archivo: C:\xampp\php\php.ini
Línea 931: Debe estar sin punto y coma:
extension=gd

Si estaba comentada (;extension=gd):
1. Descomentar (quitar ;)
2. Guardar archivo
3. Reiniciar Apache en XAMPP


================================================================================
       ERRORES CORREGIDOS DURANTE EL DESARROLLO
================================================================================

ERROR 1: Missing View Files
----------------------------
Descripción: Invalid file: "empleado/citas/ver.php"
Causa: Controlador referenciaba vistas que no existían
Solución: Creación de archivos:
  - app/Views/empleado/citas/ver.php (285 líneas)
  - app/Views/empleado/citas/dia.php (270 líneas)

ERROR 2: Undefined Array Key
-----------------------------
Descripción: Undefined array key "duracion_servicio" at line 115
Causa: Vistas usaban campo 'duracion_servicio' pero modelo retornaba 'duracion_minutos'
Solución: Agregado alias en CitasModel:
  servicios.duracion_minutos as duracion_servicio

ERROR 3: Database Column Error
-------------------------------
Descripción: Unknown column 'clientes.email' in 'field list'
Causa: Email está en tabla 'usuarios', no en 'clientes'
Solución:
  1. Agregado LEFT JOIN a usuarios
  2. Cambiado SELECT a: usuarios.email as email_cliente
  3. Aplicado a métodos obtenerCitasCompletas() y obtenerCitaCompleta()


================================================================================
       CHECKLIST FINAL DE FUNCIONALIDADES
================================================================================

DASHBOARD EMPLEADO:
[✓] Muestra citas del día actual
[✓] Botones de acción según estado
[✓] Cambio de estado mediante AJAX
[✓] Validación de transiciones de estado
[✓] Solo permite cambiar citas propias

MÓDULO DE REPORTES:
[✓] Dashboard con KPIs
[✓] Gráfica "Evolución de Citas" ELIMINADA
[✓] Top 5 Empleados
[✓] Top 5 Servicios
[✓] Reporte por fecha
[✓] Reporte por empleado
[✓] Reporte por servicio
[✓] Listado de citas realizadas
[✓] Listado de citas pendientes

EXPORTACIONES:
[✓] PDF General
[✓] PDF por Empleado
[✓] PDF por Servicio
[✓] PDF de Citas Realizadas
[✓] Excel General
[✓] Excel por Empleado
[✓] Excel por Servicio
[✓] Excel de Citas Realizadas

LIBRERÍAS Y CONFIGURACIÓN:
[✓] TCPDF 6.10.1 instalado
[✓] PhpSpreadsheet 5.3.0 instalado
[✓] Extensión GD habilitada
[✓] Apache configurado correctamente


================================================================================
       INSTRUCCIONES PARA REINICIAR APACHE
================================================================================

IMPORTANTE: Después de habilitar la extensión GD en php.ini, es necesario
reiniciar Apache para que los cambios surtan efecto.

Pasos:
1. Abrir el Panel de Control de XAMPP
2. Localizar el servicio "Apache"
3. Hacer clic en el botón "Stop"
4. Esperar a que el servicio se detenga (el botón cambia a "Start")
5. Hacer clic en el botón "Start"
6. Verificar que Apache se inició correctamente (luz verde)

Verificación:
- Acceder a: http://localhost/gestion_citas/public/diagnostico.php
- Verificar que "Extensión GD: Habilitada" aparece en verde


================================================================================
       ARCHIVOS CREADOS DURANTE EL DESARROLLO
================================================================================

VISTAS:
1. app/Views/empleado/citas/ver.php (285 líneas)
2. app/Views/empleado/citas/dia.php (270 líneas)

DOCUMENTACIÓN:
3. EXPLICACION_GENERACION_PDF.txt (600+ líneas)
4. GUIA_RAPIDA_TCPDF.txt (500+ líneas)
5. SOLUCION_COMPLETA_ERRORES.txt
6. RESUMEN_COMPLETADO_SEMANA_8.txt
7. TESTING_COMPLETO_SEMANA_8.txt (este archivo)

EJEMPLOS:
8. public/ejemplo_pdf_simple.php (233 líneas)
9. public/ejemplo_pdf_tabla.php (292 líneas)


================================================================================
                         FIN DEL DOCUMENTO DE TESTING
================================================================================

PRÓXIMOS PASOS:
1. Ejecutar todas las pruebas listadas en este documento
2. Verificar que no hay errores en el navegador (F12 > Console)
3. Verificar que las exportaciones PDF y Excel funcionan correctamente
4. Revisar que los datos coinciden entre vistas y base de datos
5. Preparar presentación para Semana 8

¿ENCONTRASTE UN ERROR?
Si encuentras algún error durante las pruebas, documentarlo con:
- URL donde ocurre
- Pasos para reproducirlo
- Mensaje de error completo
- Captura de pantalla si es posible

Desarrollado por: Ilich Esteban Reyes Botia
Proyecto: Sistema de Gestión de Citas
SENA - DICO TELECOMUNICACIONES
